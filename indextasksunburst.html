<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Visualisation Tasks Hierarchy - Sunburst</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #ffffff;
            margin: 0;
        }
        #container { position: relative; }
        #explanation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            text-align: center;
            color: #666;
            z-index: -1;
            pointer-events: none;
        }
        #percentage { font-size: 2.5em; display: block; font-weight: bold; color: #333; }
        #task-name { font-size: 0.9em; display: block; line-height: 1.2; margin-top: 5px; }
        path { stroke: #fff; stroke-width: 1px; cursor: pointer; }
        path:hover { opacity: 0.8; }
        h1 { color: #2c3e50; margin-top: 30px; margin-bottom: 5px; }
        p { color: #7f8c8d; font-size: 14px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Task Frequency Sunburst</h1>
    <p>Hover over the rings to see high-level groups, sub-groups, and specific tasks.</p>
    
    <div id="container">
        <div id="explanation">
            <span id="percentage"></span>
            <span id="task-name">Hover to explore</span>
        </div>
        <div id="chart"></div>
    </div>

    <script>
        const width = 700;
        const radius = width / 2;

        const color = d3.scaleOrdinal()
            .domain(["Topology-based", "Attribute-based", "Browsing", "Overview"])
            .range(["#4e79a7", "#f28e2c", "#e15759", "#76b7b2"]);

        const arc = d3.arc()
            .startAngle(d => d.x0)
            .endAngle(d => d.x1)
            .padAngle(0.005)
            .padRadius(radius / 3)
            .innerRadius(d => d.y0 * (radius / 3))
            .outerRadius(d => d.y1 * (radius / 3) - 1);

        d3.json("datatask.json").then(data => {
            const root = d3.hierarchy(data)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);

            d3.partition().size([2 * Math.PI, 3])(root);

            const svg = d3.select("#chart").append("svg")
                .attr("width", width)
                .attr("height", width)
                .append("g")
                .attr("transform", `translate(${width/2},${width/2})`);

            const totalValue = root.value;

            const path = svg.selectAll("path")
                .data(root.descendants().slice(1)) // Skip root node
                .join("path")
                .attr("display", d => d.depth ? null : "none")
                .attr("d", arc)
                .style("fill", d => {
                    // Color based on the top-level parent
                    let p = d;
                    while (p.depth > 1) p = p.parent;
                    return color(p.data.name);
                })
                .style("opacity", d => (1.1 - d.depth * 0.2)) // Inner rings darker
                .on("mouseover", (event, d) => {
                    const percentage = ((100 * d.value) / totalValue).toFixed(1);
                    d3.select("#percentage").text(d.value);
                    d3.select("#task-name").text(d.data.name);
                    d3.select("#explanation").style("z-index", "1");
                })
                .on("mouseleave", () => {
                    d3.select("#percentage").text("");
                    d3.select("#task-name").text("Hover to explore");
                    d3.select("#explanation").style("z-index", "-1");
                });

        }).catch(error => {
            console.error("Error loading JSON. If testing locally, use a local server (like Live Server in VS Code) or GitHub Pages.", error);
            document.body.innerHTML += "<p style='color:red'>Error loading data. See console for details.</p>";
        });
    </script>
</body>
</html>
