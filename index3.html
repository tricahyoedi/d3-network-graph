<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Enhanced Task-Category Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #fdfdfd; }
        svg { width: 100vw; height: 100vh; }
        
        /* Link Styling */
        .links line { 
            stroke: #666; 
            transition: stroke 0.2s, stroke-opacity 0.2s;
        }
        .links line:hover { stroke: #000; stroke-opacity: 1 !important; }

        /* Tooltip Styling */
        .tooltip {
            position: absolute;
            padding: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        text { font-size: 11px; pointer-events: none; fill: #333; }
        circle { stroke: #fff; stroke-width: 2px; }
    </style>
</head>
<body>

<div id="tooltip" class="tooltip"></div>

<svg></svg>

<script>
    d3.json("modified_visualization_data.json").then(function(graph) {
        const svg = d3.select("svg"),
            width = window.innerWidth,
            height = window.innerHeight,
            tooltip = d3.select("#tooltip");

        const tiers = { "category": height * 0.15, "task": height * 0.5, "study": height * 0.85 };
        const colorScale = { "study": "#ff7f0e", "task": "#1f77b4", "category": "#2ca02c" };

        const simulation = d3.forceSimulation(graph.nodes)
            .force("y", d3.forceY(d => tiers[d.group]).strength(0.8))
            .force("x", d3.forceX(width / 2).strength(0.1))
            .force("link", d3.forceLink(graph.links).id(d => d.id).distance(60))
            .force("charge", d3.forceManyBody().strength(-120))
            .force("collision", d3.forceCollide().radius(25));

        // 1. Draw Links with dynamic width and opacity
        const link = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(graph.links)
            .enter().append("line")
            // Thicker lines for higher values
            .attr("stroke-width", d => d.value > 1 ? (d.value * 0.8) : 1)
            // Higher opacity for higher values
            .attr("stroke-opacity", d => d.value > 1 ? (d.value / 10) : 0.2)
            .on("mouseover", (event, d) => {
                if(d.value > 1) { // Only show tooltip for task -> category links
                    tooltip.style("opacity", 1)
                           .html(`<strong>Score:</strong> ${d.value}`)
                           .style("left", (event.pageX + 10) + "px")
                           .style("top", (event.pageY - 10) + "px");
                }
            })
            .on("mouseout", () => tooltip.style("opacity", 0));

        const node = svg.append("g")
            .attr("class", "nodes")
            .selectAll("g")
            .data(graph.nodes)
            .enter().append("g")
            .call(d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended));

        node.append("circle")
            .attr("r", d => d.group === "task" ? 7 : 12)
            .attr("fill", d => colorScale[d.group]);

        node.append("text")
            .attr("dx", 15)
            .attr("dy", ".35em")
            .text(d => d.id);

        simulation.on("tick", () => {
            link.attr("x1", d => d.source.x).attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x).attr("y2", d => d.target.y);
            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x; event.subject.fy = event.subject.y;
        }
        function dragged(event) { event.subject.fx = event.x; event.subject.fy = event.y; }
        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null; event.subject.fy = null;
        }
    });
</script>
</body>
</html>
