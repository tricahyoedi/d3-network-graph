<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sankey Diagram â€“ Studies â†’ Tasks â†’ Categories</title>

  <!-- D3 -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <!-- D3 Sankey -->
  <script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>

  <style>
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
    }

    svg {
      border: 1px solid #e0e0e0;
    }

    .link {
      fill: none;
      stroke-opacity: 0.35;
      mix-blend-mode: multiply;
    }

    .node rect {
      stroke: #333;
      stroke-width: 0.4px;
      rx: 2;
      ry: 2;
    }

    .node text {
      font-size: 11px;
      fill: #222;
      pointer-events: none;
    }
  </style>
</head>
<body>

<h2>Sankey Diagram: Studies â†’ Tasks â†’ Categories</h2>

<svg width="1600" height="900"></svg>

<script>
const width = 1600;
const height = 900;

const svg = d3.select("svg");

// ðŸŽ¨ Color scheme by node group (academic-friendly)
const nodeColor = d3.scaleOrdinal()
  .domain(["study", "task", "category"])
  .range([
    "#4C78A8", // study â€“ blue
    "#F58518", // task â€“ orange
    "#54A24B"  // category â€“ green
  ]);

// Load JSON
d3.json("modified_visualization_data.json").then(data => {

  const sankey = d3.sankey()
    .nodeId(d => d.id)
    .nodeWidth(18)
    .nodePadding(10)
    .extent([[1, 1], [width - 1, height - 6]]);

  const graph = sankey({
    nodes: data.nodes.map(d => ({ ...d })),
    links: data.links.map(d => ({ ...d }))
  });

  // Links (inherit color from source node)
  svg.append("g")
    .selectAll(".link")
    .data(graph.links)
    .join("path")
    .attr("class", "link")
    .attr("d", d3.sankeyLinkHorizontal())
    .attr("stroke", d => nodeColor(d.source.group))
    .attr("stroke-width", d => Math.max(1, d.width));

  // Nodes
  const node = svg.append("g")
    .selectAll(".node")
    .data(graph.nodes)
    .join("g")
    .attr("class", "node");

  node.append("rect")
    .attr("x", d => d.x0)
    .attr("y", d => d.y0)
    .attr("height", d => d.y1 - d.y0)
    .attr("width", d => d.x1 - d.x0)
    .attr("fill", d => nodeColor(d.group));

  // Labels
  node.append("text")
    .attr("x", d => d.x0 - 6)
    .attr("y", d => (d.y0 + d.y1) / 2)
    .attr("dy", "0.35em")
    .attr("text-anchor", "end")
    .text(d => d.id)
    .filter(d => d.x0 < width / 2)
    .attr("x", d => d.x1 + 6)
    .attr("text-anchor", "start");

});
</script>

</body>
</html>
